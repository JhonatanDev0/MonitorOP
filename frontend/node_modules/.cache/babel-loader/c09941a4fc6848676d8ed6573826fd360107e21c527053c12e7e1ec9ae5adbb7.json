{"ast":null,"code":"import axios from 'axios';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\n// Configurar interceptor para adicionar token em todas as requisições\naxios.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Interceptor para tratar erros de autenticação\naxios.interceptors.response.use(response => response, error => {\n  // Só redireciona para login se:\n  // 1. O erro for 401\n  // 2. A requisição NÃO for de login\n  // 3. O usuário NÃO estiver na página de login\n  if (error.response && error.response.status === 401 && !error.config.url.includes('/auth/login') && window.location.pathname !== '/login') {\n    // Token inválido ou expirado\n    localStorage.removeItem('token');\n    localStorage.removeItem('usuario');\n    window.location.href = '/login';\n  }\n  return Promise.reject(error);\n});\nexport const authService = {\n  // Login\n  login: async (login, senha, lembrar = false) => {\n    const response = await axios.post(`${API_URL}/auth/login`, {\n      login,\n      senha,\n      lembrar\n    });\n    if (response.data.token) {\n      localStorage.setItem('token', response.data.token);\n      localStorage.setItem('usuario', JSON.stringify(response.data.usuario));\n    }\n    return response.data;\n  },\n  // Logout\n  logout: () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('usuario');\n  },\n  // Verificar se está autenticado\n  isAuthenticated: () => {\n    return !!localStorage.getItem('token');\n  },\n  // Obter usuário logado\n  getUsuario: () => {\n    const usuario = localStorage.getItem('usuario');\n    return usuario ? JSON.parse(usuario) : null;\n  },\n  // Verificar se é admin\n  isAdmin: () => {\n    const usuario = authService.getUsuario();\n    return usuario && usuario.role === 'admin';\n  },\n  // Verificar token no backend\n  checkToken: async () => {\n    try {\n      const response = await axios.get(`${API_URL}/auth/check`);\n      return response.data;\n    } catch (error) {\n      return null;\n    }\n  }\n};","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","error","Promise","reject","response","status","url","includes","window","location","pathname","removeItem","href","authService","login","senha","lembrar","post","data","setItem","JSON","stringify","usuario","logout","isAuthenticated","getUsuario","parse","isAdmin","role","checkToken","get"],"sources":["C:/Users/Administrador/Desktop/Projetos/MonitorOP/frontend/src/services/auth.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\n// Configurar interceptor para adicionar token em todas as requisições\r\naxios.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// Interceptor para tratar erros de autenticação\r\naxios.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    // Só redireciona para login se:\r\n    // 1. O erro for 401\r\n    // 2. A requisição NÃO for de login\r\n    // 3. O usuário NÃO estiver na página de login\r\n    if (\r\n      error.response && \r\n      error.response.status === 401 &&\r\n      !error.config.url.includes('/auth/login') &&\r\n      window.location.pathname !== '/login'\r\n    ) {\r\n      // Token inválido ou expirado\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('usuario');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport const authService = {\r\n  // Login\r\n  login: async (login, senha, lembrar = false) => {\r\n    const response = await axios.post(`${API_URL}/auth/login`, {\r\n      login,\r\n      senha,\r\n      lembrar\r\n    });\r\n    \r\n    if (response.data.token) {\r\n      localStorage.setItem('token', response.data.token);\r\n      localStorage.setItem('usuario', JSON.stringify(response.data.usuario));\r\n    }\r\n    \r\n    return response.data;\r\n  },\r\n\r\n  // Logout\r\n  logout: () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('usuario');\r\n  },\r\n\r\n  // Verificar se está autenticado\r\n  isAuthenticated: () => {\r\n    return !!localStorage.getItem('token');\r\n  },\r\n\r\n  // Obter usuário logado\r\n  getUsuario: () => {\r\n    const usuario = localStorage.getItem('usuario');\r\n    return usuario ? JSON.parse(usuario) : null;\r\n  },\r\n\r\n  // Verificar se é admin\r\n  isAdmin: () => {\r\n    const usuario = authService.getUsuario();\r\n    return usuario && usuario.role === 'admin';\r\n  },\r\n\r\n  // Verificar token no backend\r\n  checkToken: async () => {\r\n    try {\r\n      const response = await axios.get(`${API_URL}/auth/check`);\r\n      return response.data;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}